{
    "architecture": {
        "files": {
            "logic.py": "Core calculation engine for integrity metrics (Alpha, Beta, Sortino), drift detection, and data normalization. Located in mf_lab/.",
            "ui.py": "Streamlit UI components for rendering charts, metrics, and report dashboards. Located in mf_lab/.",
            "cron_mf_audit.py": "Background scheduled task for fetching data, running audits, and persisting results to DB. Runs independently.",
            "db.py": "Database abstraction layer for SQLite interactions (scan results, audit logs). Located in utils/.",
            "fortress_config.py": "Central configuration for ticker groups, sector maps, and benchmarks.",
            "streamlit_app.py": "Application entry point and navigation controller."
        },
        "dependencies": {
            "yfinance": "Market data fetching (Nifty indices, stock prices).",
            "pandas_ta": "Technical analysis library.",
            "streamlit": "Web application framework.",
            "mftool": "Mutual fund utility (supplementary to direct API calls).",
            "requests": "Direct HTTP requests to mfapi.in for NAV data.",
            "pandas": "Data manipulation and analysis.",
            "sqlite3": "Local database storage."
        },
        "dependency_graph": "streamlit_app -> [mf_lab/ui, mf_lab/logic, utils/db]; cron_mf_audit -> [mf_lab/logic, utils/db]"
    },
    "mathematical_core": {
        "formulas": {
            "scoring": "(Alpha * 0.4) + (Sortino * 0.3) + ((100 - DownsideCapture) * 0.3)",
            "normalization": "Category-Isolated Min-Max Scaling: ((Score - Cat_Min) / (Cat_Max - Cat_Min)) * 100. Defaults to 50.0 if variance is 0, 100.0 if single fund.",
            "alpha": "Annualized excess return over benchmark (60-day rolling average).",
            "sortino": "(CAGR - RiskFreeRate_6%) / DownsideDeviation",
            "win_rate": "Percentage of rolling 252-day periods where Fund_CAGR > Benchmark_CAGR",
            "beta": "Covariance(Fund, Benchmark) / Variance(Benchmark)",
            "tracking_error": "Stdev(Fund_Return - Benchmark_Return) * Sqrt(252) * 100",
            "capture_ratio_upside": "(Mean_Fund_Return_UpMkt / Mean_Benchmark_Return_UpMkt) * 100",
            "capture_ratio_downside": "(Mean_Fund_Return_DownMkt / Mean_Benchmark_Return_DownMkt) * 100"
        },
        "integrity_thresholds": {
            "tracking_error_limit": 8.0,
            "beta_limits": {
                "Large Cap": 1.15,
                "Flexi/Other": 1.2,
                "Mid Cap": 1.25,
                "Small Cap": 1.45
            },
            "technical_debt_note": "mf_lab/logic.py currently uses 1.40 for Small Cap beta threshold in 'detect_integrity_issues', but 1.45 in 'calculate_drift_status'. 1.45 is the Source of Truth."
        }
    },
    "taxonomy": {
        "categories": {
            "priority_order": [
                "Focused",
                "Value",
                "Contra",
                "ELSS",
                "Small Cap",
                "Mid Cap",
                "Large Cap"
            ],
            "fallback": "Flexi/Other",
            "exclusions": [
                "regular",
                "idcw",
                "etf"
            ],
            "inclusions": [
                "direct",
                "growth"
            ]
        },
        "benchmarks": {
            "Large Cap": "^NSEI",
            "Mid Cap": "^NSEMDCP50",
            "Small Cap": "^CNXSC",
            "Flexi/Other": "^NSEI",
            "Focused": "^NSEI (Proxy for Broad Market)",
            "Value": "^NSEI (Proxy for Broad Market)",
            "Contra": "^NSEI (Proxy for Broad Market)",
            "ELSS": "^NSEI (Proxy for Broad Market)"
        }
    },
    "audit_workflows": {
        "background_scan": {
            "frequency": "Weekly, Sunday at 9:00 PM IST",
            "rate_limiting": "time.sleep(0.4) between API calls to respect AMFI limits.",
            "safety_checks": "Sleep enforced in main loop of cron_mf_audit.py.",
            "survival_filter": "Funds with < 750 days of history are skipped."
        },
        "health_check": {
            "sector_rotation": "Calculates 1-month returns for Banking, IT, Auto, FMCG, Infra. Identifies rotation flow.",
            "hidden_gem": "Identifies fund with largest positive Delta in Fortress Score compared to previous audit."
        }
    },
    "data_schema": {
        "scan_mf_table": {
            "Symbol": "Name of the Mutual Fund Scheme.",
            "Scheme Code": "Unique identifier from AMFI.",
            "Category": "Derived category (e.g., Small Cap, Focused).",
            "Score": "Raw calculated Fortress Score before normalization.",
            "Fortress Score": "Normalized 0-100 score relative to category peers (calculated during reporting/viewing).",
            "Alpha (True)": "Rolling 60-day annualized Alpha.",
            "Sortino": "Risk-adjusted return ratio.",
            "Upside Cap": "Upside Capture Ratio.",
            "Downside Cap": "Downside Capture Ratio.",
            "Max Drawdown": "Maximum observed loss from peak to trough.",
            "Win Rate": "Consistency metric (% of rolling years beating benchmark).",
            "Verdict": "Integrity/Drift Status (e.g., 'Stable', 'Critical').",
            "Price": "Latest NAV.",
            "Beta": "Volatility relative to benchmark.",
            "Tracking Error": "Deviation from benchmark returns."
        },
        "dynamic_config": {
            "ticker_groups": {
                "Nifty 50": [
                    "RELIANCE.NS",
                    "TCS.NS",
                    "HDFCBANK.NS",
                    "ICICIBANK.NS",
                    "INFY.NS",
                    "BHARTIARTL.NS",
                    "SBIN.NS",
                    "ITC.NS",
                    "LICI.NS",
                    "HINDUNILVR.NS",
                    "LT.NS",
                    "BAJFINANCE.NS",
                    "MARUTI.NS",
                    "SUNPHARMA.NS",
                    "ADANIENT.NS",
                    "KOTAKBANK.NS",
                    "TITAN.NS",
                    "ULTRACEMCO.NS",
                    "AXISBANK.NS",
                    "NTPC.NS",
                    "ONGC.NS",
                    "ADANIPORTS.NS",
                    "ASIANPAINT.NS",
                    "COALINDIA.NS",
                    "JSWSTEEL.NS",
                    "BAJAJ-AUTO.NS",
                    "NESTLEIND.NS",
                    "GRASIM.NS",
                    "HINDALCO.NS",
                    "POWERGRID.NS",
                    "ADANIPOWER.NS",
                    "WIPRO.NS",
                    "EICHERMOT.NS",
                    "SBILIFE.NS",
                    "TATAMOTORS.NS",
                    "BPCL.NS",
                    "DRREDDY.NS",
                    "HCLTECH.NS",
                    "JIOFIN.NS",
                    "TECHM.NS",
                    "BRITANNIA.NS",
                    "TATAPOWER.NS",
                    "BAJAJFINSV.NS",
                    "INDUSINDBK.NS",
                    "SHRIRAMFIN.NS",
                    "TVSMOTOR.NS",
                    "APOLLOHOSP.NS",
                    "CIPLA.NS",
                    "BEL.NS",
                    "TRENT.NS"
                ],
                "Nifty Next 50": [
                    "ADANIENSOL.NS",
                    "ADANIGREEN.NS",
                    "AMBUJACEM.NS",
                    "DMART.NS",
                    "BAJAJHLDNG.NS",
                    "BANKBARODA.NS",
                    "BHEL.NS",
                    "BOSCHLTD.NS",
                    "CANBK.NS",
                    "CHOLAFIN.NS",
                    "COLPAL.NS",
                    "DABUR.NS",
                    "DLF.NS",
                    "GAIL.NS",
                    "GODREJCP.NS",
                    "HAL.NS",
                    "HAVELLS.NS",
                    "HZL.NS",
                    "ICICILOMB.NS",
                    "ICICIPRULI.NS",
                    "IOC.NS",
                    "IRCTC.NS",
                    "IRFC.NS",
                    "JINDALSTEL.NS",
                    "JSWENERGY.NS",
                    "LTIM.NS",
                    "LUPIN.NS",
                    "MARICO.NS",
                    "MRF.NS",
                    "MUTHOOTFIN.NS",
                    "NAUKRI.NS",
                    "PFC.NS",
                    "PIDILITIND.NS",
                    "PNB.NS",
                    "RECLTD.NS",
                    "SAMVARDHANA.NS",
                    "SHREECEM.NS",
                    "SIEMENS.NS",
                    "TATACOMM.NS",
                    "TATAELXSI.NS",
                    "TATAMTRDVR.NS",
                    "TORNTPHARM.NS",
                    "UNITDSPR.NS",
                    "VBL.NS",
                    "VEDL.NS",
                    "ZOMATO.NS",
                    "ZYDUSLIFE.NS",
                    "ABB.NS",
                    "TIINDIA.NS",
                    "POLYCAB.NS"
                ],
                "Nifty Midcap 150": [
                    "ABBOTINDIA.NS",
                    "ABCAPITAL.NS",
                    "ACC.NS",
                    "ADANITOTAL.NS",
                    "AIAENG.NS",
                    "AJANTPHARM.NS",
                    "ALKEM.NS",
                    "APARINDS.NS",
                    "APLAPOLLO.NS",
                    "APOLLOTYRE.NS",
                    "ASHOKLEY.NS",
                    "ASTRAL.NS",
                    "AUROPHARMA.NS",
                    "AVANTIFEED.NS",
                    "BALKRISIND.NS",
                    "BANDHANBNK.NS",
                    "BANKINDIA.NS",
                    "BATAINDIA.NS",
                    "BEL.NS",
                    "BERGEPAINT.NS",
                    "BHARATFORG.NS",
                    "BIOCON.NS",
                    "BLUESTARCO.NS",
                    "BSE.NS",
                    "CESC.NS",
                    "CGPOWER.NS",
                    "CHAMBLFERT.NS",
                    "CHOLAHLDNG.NS",
                    "COFORGE.NS",
                    "CONCOR.NS",
                    "COROMANDEL.NS",
                    "CREDITACC.NS",
                    "CROMPTON.NS",
                    "CUMMINSIND.NS",
                    "CYIENT.NS",
                    "DEEPAKNTR.NS",
                    "DELHIVERY.NS",
                    "DEVYANI.NS",
                    "DIXON.NS",
                    "EASEMYTRIP.NS",
                    "EDELWEISS.NS",
                    "EICHERMOT.NS",
                    "EMAMILTD.NS",
                    "ENDURANCE.NS",
                    "ESCORTS.NS",
                    "EXIDEIND.NS",
                    "FEDERALBNK.NS",
                    "FORTIS.NS",
                    "GICRE.NS",
                    "GLENMARK.NS",
                    "GMRINFRA.NS",
                    "GODREJIND.NS",
                    "GODREJPROP.NS",
                    "GRANULES.NS",
                    "GUJGASLTD.NS",
                    "HAPPSTMNDS.NS",
                    "HDFCAMC.NS",
                    "HFCL.NS",
                    "HINDCOPPER.NS",
                    "HINDPETRO.NS",
                    "HUDCO.NS",
                    "IDBI.NS",
                    "IDFCFIRSTB.NS",
                    "IEX.NS",
                    "IGL.NS",
                    "INDHOTEL.NS",
                    "INDIAMART.NS",
                    "INDIANB.NS",
                    "INDIGO.NS",
                    "IPCALAB.NS",
                    "IRB.NS",
                    "ITDCEM.NS",
                    "JBCHEPHARM.NS",
                    "JKCEMENT.NS",
                    "JSL.NS",
                    "JSWINFRA.NS",
                    "JUBLFOOD.NS",
                    "KALYANKJIL.NS",
                    "KEI.NS",
                    "KPITTECH.NS",
                    "KPRMILL.NS",
                    "L&TFH.NS",
                    "LAURUSLABS.NS",
                    "LICHSGFIN.NS",
                    "LINDEINDIA.NS",
                    "LLOYDSME.NS",
                    "LUPIN.NS",
                    "MAHABANK.NS",
                    "MAHINDCIE.NS",
                    "MANAPPURAM.NS",
                    "MANKIND.NS",
                    "MARICO.NS",
                    "MAXHEALTH.NS",
                    "MAZDOCK.NS",
                    "METROPOLIS.NS",
                    "MFSL.NS",
                    "MGL.NS",
                    "MOTILALOFS.NS",
                    "MPHASIS.NS",
                    "MRPL.NS",
                    "MUTHOOTFIN.NS",
                    "NATCOPHARM.NS",
                    "NATIONALUM.NS",
                    "NAVINFLUOR.NS",
                    "NBCC.NS",
                    "NHPC.NS",
                    "NLCINDIA.NS",
                    "NMDC.NS",
                    "NYKAA.NS",
                    "OBEROIRLTY.NS",
                    "OFSS.NS",
                    "OIL.NS",
                    "PAGEIND.NS",
                    "PATANJALI.NS",
                    "PAYTM.NS",
                    "PERSISTENT.NS",
                    "PETRONET.NS",
                    "PHOENIXLTD.NS",
                    "PIIND.NS",
                    "PNBHOUSING.NS",
                    "POLYMED.NS",
                    "POONAWALLA.NS",
                    "PRESTIGE.NS",
                    "PVRINOX.NS",
                    "QUESS.NS",
                    "RADICO.NS",
                    "RAILTEL.NS",
                    "RAJESHEXPO.NS",
                    "RAMCOCEM.NS",
                    "RATNAMANI.NS",
                    "RBLBANK.NS",
                    "RECLTD.NS",
                    "RELAXO.NS",
                    "RVNL.NS",
                    "SAIL.NS",
                    "SCHAEFFLER.NS",
                    "SHREECEM.NS",
                    "SJVN.NS",
                    "SKFINDIA.NS",
                    "SOLARINDS.NS",
                    "SONACOMS.NS",
                    "SRF.NS",
                    "STLTECH.NS",
                    "SUNTV.NS",
                    "SUPREMEIND.NS",
                    "SUZLON.NS",
                    "SWIGGY.NS",
                    "SYNGENE.NS",
                    "TATACHEM.NS",
                    "TATATECH.NS",
                    "TRIDENT.NS",
                    "UCOBANK.NS",
                    "UNIONBANK.NS",
                    "UPL.NS",
                    "VGUARD.NS",
                    "VI.NS",
                    "VOLTAS.NS",
                    "WHIRLPOOL.NS",
                    "YESBANK.NS",
                    "ZEEL.NS"
                ]
            },
            "sector_map": {
                "HDFCBANK.NS": "Banking",
                "ICICIBANK.NS": "Banking",
                "SBIN.NS": "Banking",
                "KOTAKBANK.NS": "Banking",
                "AXISBANK.NS": "Banking",
                "INDUSINDBK.NS": "Banking",
                "BANKBARODA.NS": "Banking",
                "CANBK.NS": "Banking",
                "PNB.NS": "Banking",
                "BAJFINANCE.NS": "NBFC",
                "BAJAJFINSV.NS": "NBFC",
                "CHOLAFIN.NS": "NBFC",
                "SHRIRAMFIN.NS": "NBFC",
                "MUTHOOTFIN.NS": "NBFC",
                "IDFCFIRSTB.NS": "Banking",
                "TCS.NS": "IT",
                "INFY.NS": "IT",
                "WIPRO.NS": "IT",
                "HCLTECH.NS": "IT",
                "TECHM.NS": "IT",
                "LTIM.NS": "IT",
                "MPHASIS.NS": "IT",
                "PERSISTENT.NS": "IT",
                "COFORGE.NS": "IT",
                "TATAELXSI.NS": "IT",
                "RELIANCE.NS": "Energy",
                "ONGC.NS": "Energy",
                "BPCL.NS": "Energy",
                "IOC.NS": "Energy",
                "ADANIPOWER.NS": "Energy",
                "TATAPOWER.NS": "Energy",
                "NTPC.NS": "Energy",
                "POWERGRID.NS": "Energy",
                "JSWSTEEL.NS": "Metals",
                "HINDALCO.NS": "Metals",
                "VEDL.NS": "Metals",
                "JINDALSTEL.NS": "Metals",
                "MARUTI.NS": "Auto",
                "TATAMOTORS.NS": "Auto",
                "BAJAJ-AUTO.NS": "Auto",
                "EICHERMOT.NS": "Auto",
                "TVSMOTOR.NS": "Auto",
                "SUNPHARMA.NS": "Pharma",
                "DRREDDY.NS": "Pharma",
                "CIPLA.NS": "Pharma",
                "HINDUNILVR.NS": "FMCG",
                "ITC.NS": "FMCG",
                "NESTLEIND.NS": "FMCG",
                "BRITANNIA.NS": "FMCG",
                "LT.NS": "Infra",
                "ADANIPORTS.NS": "Infra",
                "BEL.NS": "Defense",
                "HAL.NS": "Defense",
                "TRENT.NS": "Retail",
                "ZOMATO.NS": "Retail",
                "NYKAA.NS": "Retail"
            }
        }
    }
}